/**
 * Copyright (c) 2013 Azeem Arshad
 * See the file license.txt for copying permission.
 */

CanvasTestWithFM("Superscope test", 7, function(canvas, gl, fm, copier) {
    var code = {
        init: "n=3",
        perFrame: "c=0",
        perPoint: [
            "x=select(c, -0.75, -0.15, 0.5);",
            "y=select(c, -0.5,  0.5, -0.23);",
            "red  =select(c, 1, 0, 0);",
            "green=select(c, 0, 1, 0);",
            "blue =select(c, 0, 0, 1);",
            "c=c+1;"
        ]
    };
    var code2 = {
        init: "n=3",
        perFrame: "c=0",
        perPoint: [
            "x=select(c, -0.75, -0.15, 0.8);",
            "y=select(c, -0.5,  0.5, 0);",
            "red  =select(c, 1, 0, 0);",
            "green=select(c, 0, 1, 0);",
            "blue =select(c, 0, 0, 1);",
            "c=c+1;"
        ]
    };

    var testData = [
        [{code: code, thickness: 1, drawMode: "DOTS"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAB2UlEQVR4Xu3bQWoCABQDUb3/odsK7T4u/EzhCe6iP8yYjejz8Xh8/Tw9IgSehERM/NYgpOXjQQghMQKxOhZCSIxArI6FEBIjEKtjIYTECMTqWAghMQKxOhZCSIxArI6FEBIjEKtjIYTECMTqWAghMQKxOhZCSIxArI6FEBIjEKvz9kJev6p7vcjjMwTeFvKZGt71jwAhsc8CIYTECMTqWAghMQKxOhZCSIxArI6FEBIjEKtjIYTECMTqWMgs5OZrVUJmITdBQm44z1cImVHdBAm54TxfIWRGdRMk5IbzfIWQGdVNkJAbzvMVQmZUN0FCbjjPVwiZUd0ECbnhPF8hZEZ1EyTkhvN8hZAZ1U2QkBvO8xVCZlQ3QUJuOM9XCJlR3QQJueE8XyFkRnUTJOSG83yFkBnVTZCQG87zFUJmVDdBQm44z1cImVHdBAm54TxfIWRGdRMk5IbzfIWQGdVNkJAbzvMVQmZUN0FCbjjPVwiZUd0ECbnhPF/5P0Ju/nM5g/tU8P8I+RSB2PsSQkiMQKyOhRASIxCrYyGExAjE6lgIITECsToWQkiMQKyOhRASIxCrYyGExAjE6lgIITECsToWQkiMQKyOhRASIxCrYyGExAjE6lhITMg3AnVnAR5HEysAAAAASUVORK5CYII="],
        [{code: code, thickness: 3, drawMode: "DOTS"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAB+0lEQVR4Xu3bS2oDQBADUfv+h84HsghZyUNGyPAM2fV0iyrkRUiej8fj4+vHZ4TAk5AREz8xCNny8SCEkDECY3E0hJAxAmNxNISQMQJjcTSEkDECY3E0hJAxAmNxNISQMQJjcTSEkDECY3E0hJAxAmNxNISQMQJjcTSEkDECY3E05J2F/P4Drm+TPv9P4KWGEPL/Av5uJOQ+45cuvCTkpc2GjwgQcoTt3iNC7rE92kzIEbZ7jwi5x/ZoMyFH2O49IuQe26PNhBxhu/eIkHtsjzYTcoTt3iNCIra93+IRQkhEYGxIQ8aE9OL4yuqxji4REmHqDRHSYx1dIiTC1BsipMc6ukRIhKk3REiPdXSJkAhTb4iQHuvoEiERpt4QIT3W0SVCIky9IUJ6rKNLhESYekOE9FhHlwiJMPWGCOmxji4REmHqDRHSYx1dIiTC1BsipMc6ukRIhKk3REiPdXSJkAhTb4iQHuvoEiERpt4QIT3W0SVCIky9IUJ6rKNLhESYekOE9FhHlwiJMPWGCOmxji69h5Def5RF0G4OEXKT7sFuQg6g3XzyHkJuEhjbTQghYwTG4mgIIWMExuJoCCFjBMbiaAghYwTG4mgIIWMExuJoCCFjBMbiaAghYwTG4mgIIWMExuJoCCFjBMbiaAghYwTG4mgIIWMExuJ8AruObQFy51wGAAAAAElFTkSuQmCC"],
        [{code: code, thickness: 300, drawMode: "DOTS"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAABa0lEQVR4Xu3VwQkAQAjEQO2/aA+uijzGCkLC4s7cjcsYWEEyLT6IIK0egsR6CCJIzUCMxw8RJGYghmMhgsQMxHAsRJCYgRiOhQgSMxDDsRBBYgZiOBYiSMxADMdCBIkZiOFYiCAxAzEcCxEkZiCGYyGCxAzEcCxEkJiBGI6FCBIzEMOxEEFiBmI4FiJIzEAMx0IEiRmI4ViIIDEDMRwLESRmIIZjIYLEDMRwLESQmIEYjoUIEjMQw7EQQWIGYjgWIkjMQAzHQgSJGYjhWIggMQMxHAsRJGYghmMhgsQMxHAsRJCYgRiOhQgSMxDDsRBBYgZiOBYiSMxADMdCBIkZiOFYiCAxAzEcCxEkZiCGYyGCxAzEcCxEkJiBGI6FCBIzEMOxEEFiBmI4FiJIzEAMx0IEiRmI4ViIIDEDMRwLESRmIIZjIYLEDMRwLESQmIEYjoUIEjMQw7EQQWIGYjgWIkjMQAzHQgSJGYjhPE5Hx53K44yoAAAAAElFTkSuQmCC"],

        [{code: code, thickness: 1, drawMode: "LINES"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAE10lEQVR4Xu2cC4hVVRSGPwtKI43UQHGktIeSUjihUdpDSSmctFDJMhRKywlSKgWFctICBa1wgsbSAiXNUClNSTS0hxYpKYWG9tCiEYVyQo20oMfeFTSGo/eee/bZ/zmtDXeYgb3X+v//m3Xn3j1wWwF/uIctkQRaGRAREv/IMCBaPDAgBkQsATE5NiEGRCwBMTk2IQZELAExOTYhBkQsATE5NiEGRCwBMTk2IQZELAExOTYhBkQsATE5NiEGRCwBMTk2IQZELAExOTYhBkQsATE5NiEGRCwBMTllT8hvZ8HZv4u5KJCcsoF478dbQ5sTBUpByEoiIMfOh7Y/CbkokJREQLz/w+2hQ1OBkhCxkhiI13+wE3Q+JOKkIDIqAtLYBaoOFCQJERsVAfEe9nWD7vtF3BRARsVAvrgcrviyAEmIWKgYiPexqxf03i3iKOcyUgHiM9jRB6p35jwNAfmpAdnWF/ptF3CUcwmpAfE5bOkPA7bmPJHI8lMF8u5NcPN7kR3lvH2qQHwWGwbDkI05TyWi/NSBeC9rh0LNuoiuQrQ+5xf49dwQlU+qGQTI6mEwfE1w7dk1aHsUjrXLpF8QIF75ipEwamUmHsI26fg9/HBR2B7NqgcD8tpouHt5Zj7CNKr6Dhq7hqndQtVgQHy/xWNh3JJM/aTX7NKv4OvL0qtXYqWgQLyGheNhwqIS1ahsu9LdA33u7oMirOBAGiZC7YIIzpK2rP7E3QNdk/R0xeeCA/EK50+CyfUVaw1f4LoP4aPrw/c5TYdMgDzzKDz2bFSfZ24+cBNsHnTmfYF3ZALEe5g9DabPCeymkvK3uOuFd9w1Q+SVGRDvc+YMqJsV2fGp2te85a4XbpcQlimQGTNhVp2E739FjHDvXle5d7EiK1Mg3vO02TBnuoj7Ma/C0ntFxPwtI3MgU+bCvKkCGdz3Mrxyv4CQkyVkDsS3nzQf6idHzKL2BWh4KKKAlltHAeLlTGyABbURMnnEvf5+zr0OF13RgIxfCIsmZJyK1B+wU3uPBsTLGbsYlozLCErdk+51t3uIr6hA7lkKy8ZklNBTj8MTT2fULHmbqEC87JErYOWo5AZKOjl3CkydV9LW2JuiA/EBDFsNa4YHiqL+Yfey7vlAxdMvKwFk6FpYV5O+OV58AB58KUDhcCUlgHh7gzfAxiEpGs3pvytlgKR6+738Lhj9eop0syslA8Rb7r8Ftg6o0Pwbd8Cdb1ZYJN5xKSA+hr7bYHu/hIG8fSvctj7hYY1jckD67ICd1QnC2TQQBm1OcFDriBwQH0+vXbC7d5lBvX8D3PhBmYf0tksC6bEH9vYsI6yP3XPcte65rgBLEojPtds+2N+9hIQ/vQqu/qyEjfnYIgvEx9elEQ5UnSbIPT2g5958JF2iSmkgnQ7Coc4tOPnmYrjk2xJt5mebNBAfY/vD0NThP4EW+CMk5IG0OwJHL2gGpOlCR+nH/PzKl6lUHoj30/o4nGjjvvnZfTnP/VDglQsgf+X/P/nktPwAKfBUNLdmQMRAGxADIpaAmBybEAMiloCYHJsQAyKWgJgcmxADIpaAmBybEAMiloCYHJsQAyKWgJgcmxADIpaAmBybEAMiloCYHJsQAyKWgJgcmxADIpaAmBybEAMiloCYHJsQMSB/AmlkDhDZzw0iAAAAAElFTkSuQmCC"],
        [{code: code, thickness: 3, drawMode: "LINES"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFm0lEQVR4Xu2ceYhWVRjGP1dQMUU0zG0M15QsGsWFFNPECRrDBTPMpSSFMTdcqEZxxF3DJLNQUHNBHFCTFLRN04FccMIlNzQYd1HBrQYjl+7rN5dHNPXee95zz3s/3guf/nPve57n+c177j3nW8qlUqn73ksPIQmUUyBCSJTJUCCyeKQUiAIRloAwOdohCkRYAsLkaIcoEGEJCJOjHaJAhCUgTI52iAIRloAwOdohCkRYAsLkaIcoEGEJCJOjHaJAhCUgTI52iAIRloAwOdohCkRYAsLkaIcoEGEJCJMTqkPoE3X3yqdfle4Ic5IhckIBIc//VAaUaqUZkoIgG6GBlFZJpe5WSEOpcVOQkwyREhoI+b5eA1DqXM2QJITYiASEtF+uAyj1LwhxkwEyIgO58EJ62qLpK+tMBiQhxEJkIKS/JAtQmp0S4ijhMoyAnGqCJ66WJxKehBD5RkDIw9GXAKXNYSGuEizDGAh5P/AKoLQtTnAaAqSzANmfDSAd9gpwlWAJLEDI/28dAaVLUYITcSydDUjR61iXdNvh2FWCh2cDQhn80g1Qcn5IcCoOpbMCIR9bcwCl12aHzjiHruLtotIK+E5Fb172/rd4sAPZ/DYWi32+s6g8rtI1r6Vh0Ku0mvVR2YGQ4g19AGVAoXUP9gaoezHdFQTjWi174zxU2QqQwv544hq4NhYf/INklWCauuRt3MV0WAFC2le/DygffBuTG65hWhxHZ5S8yFU1UB1rQGj0ZR8CyoilgfS4P6nNQcA40TJ2PVaBLBkOICO/jt1b+AHb7cM0dcjbD3JwWAVCfhZ9DCjjFjpwGHTIzrvQGfvaB72K/TzrQBaOwbpk4ufs+nkKvvkTOqOoC0/NiFWsAyFd8yYCSv6siEptXpazFd2xw9tucHjEAoT8zcgHlGkFDh0/OvQ7m9Ad295yLiw2IAVTsVicOdm577SAd9ehMzb1FiEqNiDk9rOZgDJ/kmP/g1eiMwoHOBaD4WMFMmkunrgWjHeYwUfeosjfLFw1xKGQx4eOFQgNP/YLQPlqlIMsRn2JaWrpCAcCnj5k7EBITt5iQIk1kwnz0RmLRouDQYKcABm+BECWD4spl/zpHoyynVvnN7Ane3YChOQMXQEoawZZhjLde6zzt9FnTLE8mFl5Z0AGrcK6ZN17ZiaeefXsTwCkYNozT3d5gjMg/jLA/2rDxr6WYlgwDveNT+dYGoSvrFMgZKP3RnTKllw+Yw8qLc7D26+idzbh2zmQ3O+xWGTduaA3Y/z7Rt43zKTtlXMOhKz13AYo27szmF0zENPUsOUMBeMrIQJI95/xxLWzq6H59d7NyO+MBL6hLwIIIaD3h/xv+O7uFBEKfQbJh9FvQ8Qibi8TA4RiaL8HUIrbhgzmxx6YpnK3hLxYzumigGTvB5CDr4YIaVdndEYPb/5L8CEKCOX48iFAOdYqYLL00Xt/qnrj14AXyTxNHJBWR7AuOdk8QGjFrwFGp90BLpB9ijggFFfTk4ByuvFTAvyjNe4b2b/LTjqgOpFASHuj04Bysd7/uKFvnPrTVOujAe3KP00skHrnsVi88vwjQZ5tgM5o+qf8lEMoFAuEPNS+Aig3apa58n9Cgrqj4bkQVpNxqmgg9NUMf7H4V3Uv0JveP/40laE/siIaCP1NV/07DeV2ee93ofwPJjx3Kxl/7hFUigfywJP/y2kEpPK/EWwm55JkAElOnsZKFYhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbVFIhxhLwFFAhvnsbV/gOq2rYQXdclggAAAABJRU5ErkJggg=="],
        [{code: code, thickness: 25, drawMode: "LINES"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFMUlEQVR4Xu1ce2iNYRjfotzaZHIrco0yhBiiDCGTW1kYUYwijKZstMkWo8gl8YdLkUviD5c2mbKpLZdkK6Yml9Ymm7Vhk43msnfW2tl2zve87/M+356P59T++n6/5/d7nt95ds737uwEBwUF/a7/kQeTCQRLIEySaLQhgfDKI0gCkUCYTYCZHdkQCYTZBJjZkQ2RQJhNgJkd2RAJhNkEmNmRDZFAmE2AmR3ZEAmE2QSY2ZENkUCYTYCZHdkQCYTZBJjZkQ2RQJhNgJkd2RAJhNkEmNmRDZFAmE2AmZ3gug70H5Tr+JNZ14ztNPzKqulM77BLLb3Gv6DQEEhVCH0rodX0Gv+CQtOLekUYfTs9K+k1vK7g8y6rtA99O33L6DW8rOATSHF/+lYGlNBreFmh1X3I28H07Qx5R6/hVYVWgRQOp29lxCt6Da8qtHmn/iKcvp1RBfQaXlTwe3SSN5a+nXH59BpeU/AbyOMI+lYmPaHX8JpCwMPFnKn07UzLpdfwkkLAQLIi6VuZkU2v4SUFx+P3zNn07cy5R6/hFQXHQFQj6VH07czPoNfwUejkwmnnd/1TW1AgNxbRD2vxTXqNJoXQL/RiVd2NNECBqMrXlhrV1yJFX9eCm4F7fTTj6bDKe+ugfbDgQC6vMNYAE2OugKFmwP7FZjwdVskAHXQrLDgQxTy/GqUFIq+5AILpg4a+1ufoMt4M02XgAlHsM+vQmo4FYs86QvQAI104p3lp57xJa0PUFE5u1JuFCXrTKROWH864ZxaL+SmVN96ahnYgSvnYVmv6fgvFHbegMfmhhSIOJR5NsaphFMiheKse2iy24zBSY3o2sgCA/iASANKDGAWiJNIS9IRM0IkHTFiNnDl3EWQgNXMuEAiHGQeiJFKS4EKmyORUA+aCWwYkTcrthZoEGBwVSFIKTASDSk3WZC+9pkkwgF+PNiDBKKhAlERCGkwIgzqQCGSvvAgEImCXViHIzlR0IPGHnEWwiMM7ABXW2r55aUPzHP1NGDoQZXvrMcDAkJDjcQEKbDyJrA6gn9oEAOEhVgJRNtptJtuO4KfgVOHodieEtevWAll3xponv4XOxra4tBPzvhjo96AL7++bWbEWiKq5+jywSQTswppGcvJeRBUgNWUPEGgPZjWQFZftGfNX6UpM45V9u+jFdu+n12ihYDUQVduV24AiL5zdmGVpPRBlY9ENMzMQ1s3izRAYDrPlBI6PYJMEEpWOcBSAmvF+PU3h5lU3nKbXCKBAEojSm51pt697H7z850r4LMgCicyCm3BCZpctc4Lgry+/iq9hoQJZIMrb1By8w9zyxfgiThWWEL7oOWm3uE4aiNKKeKzpqBn8ScU8czKUGXUHinQFRx7I2DyzPvIrZ5oRdViz7uugXcGSB6K6CH+h30vB5//zo/euBDK8UC+QV1UT9Agm6IlPTVjkHFcCUV0Mfgvr5d3X0TAgBjXmOYZNynUtENWF0yc5S77Jf5y6GkifUv9PrrLagaTPvIbig4roNZAKrgaivIZVtHZc+aMvsg0AvV+AZwOA7hbE9UBCqnxbq67rQd9r2Cd6DUsKrgeifHeu+eu+9ldXS20EKNPtG72GRYV2CaTBf/03p5E/PPjNae0XCHka3hSQQJjlJoFIIMwmwMyObIgEwmwCzOzIhkggzCbAzI5siATCbALM7MiGSCDMJsDMjmyIBMJsAszsyIZIIMwmwMyObIgEwmwCzOzIhkggzCbAzI5siATCbALM7MiGSCDMJsDMjmwIs0D+ACyRDhCiMwYcAAAAAElFTkSuQmCC"],
        [{code: code2, thickness: 25, drawMode: "LINES"}, "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFPElEQVR4Xu2df2hOURjH79os0pRJo0ZIKArJb2USYmVLo0iWHynSlqZYQm1CQlFIDU3ZkgmFhCKRH6lJpCmWUFsh2R8TFnu2vdvL+7675557v+c+532fW/vvnPN9vt9P557z3l9LcxznT/ufHEwSSBMgTEh0lSFAePFwBIgAYZYAs3JkhggQZgkwK0dmiABhlgCzcmSGCBBmCTArR2aIAGGWALNyZIYIEGYJMCtHZogAYZYAs3JkhggQZgkwK0dmiABhlgCzcmSGCBBmCTArR2aIAGGWALNy0n6n4x+Uy2hj5ppxOR2nrNa++Ar7/cBrJINCB5DvWXgrA1rwGsmg0L2of8nG2xn0Fa9hu8I/u6ymHLydIc14DZsV/gHyIRdvZdhHvIbNCjG/Q96NxNsZ1YjXsFUhBkjDGLyVsW/wGrYqxP2l/nI83s6EV3gNGxUSXjqpn4S3M/k5XsM2hYRAnkzDW5n+FK9hm0KvFxcfzMbbmfMQr2GTQq9A7ubhrcy7h9ewScH18vutBXg7C2/jNUJT6NvqOL/6OE5bhlIJrkBolOtLlMby1Sj/hq/u/DoP+uw4PzM7YQQN5EoB3m/hVbyGEYXh73tAoICQkYtFeDvL6/AaMIVxr3tmQwQEEkjNSpiV7oFX1eI1AleY8qwTRHT4JoCQkeo1gduJGbD4HF4jMIUZj2JnRTQc5AyJmKhaH5idhANtOI3X8KUw/07iWWEayIlNvqwodd58UqmZ+UZL23ce8U5NYZ2yIgkcLcFnUXoMr6GssLIm/s7JDY6JUxaZOFSmbEW74bbD2l2D67i+qvedExcg5Hj/juB8Jxqp/ABeI65CyVG1nRMnIGSkYhc+sN2VeI1uhfJ97muEGwTTi3p0PLsq8GFV7sZrOHt3qq8RnIFQVDv24wM7UA7SOLLV+xrBHUjZIVBYUcMe3hawxqmN+msEdyAUFa2B6ONYaUAKZ9aq/7p2uxziBsfUtjdeNJtOBBRYL8Oc3OxD48IK77+ubQZCW3b0cXqDhsK1fPedU6Kdkc1AKKo11RqBeexyrlixA91/jnfV1ctpxnYgdIUBfdSuclGgx2Uid+lSHQhFVXQRjcRx6pbH0aCn+1Qu8qXSDInEVHAFD+VqYZdG4wj3NcINQrKuIREMS67jgdyYOlh9jUh1IIRjwS0MlNuz+ntfIwSI4+TdDRbIvfZNk/YaIUA6Ycx+EByUh/RYq+6iHSaQlgGeQlB6UM7TiP81nvbET++evk/p4W+bgDQN1TIOBzKpXquumE7P6fUIG4C8He3LMBwIVTf+pa8aOzq/opeIOAN5MdG/yfYRjAAZ0+C/1jf0qh1HII9n+jcXNYIRIKQ38p2/uhvpZVRuQO7P9WcqTm9jQEg794N+/R/plW0uQG4u1jfi0tMokJwmfR/N9FGDsIFcwj9xbhQI4cj+ogflK336Iywgytf89bxF9zIOJOu7XtEt9IEc00B83aLU82kcCJVJb3l5PX7QJ6RMAQn8qQp1t6EAofLSf6sXSS3b0g0AqdjjrShA69CAePZC/yAWNUO2H/RcDqpDagPZchyVq/a4qQlk3VntwNAdUw/I6vPoTH2NnzpAll32FZSpzskPZBHoXjKIUPICsfSrNskHxPKPcCUPkCT5bqD9QHI/gc7m4QxrL5CB38JJDKxqH5DMX+BIwh3eHiDh5mRMXYAYi1pNSICo5WSslQAxFrWakABRy8lYKwFiLGo1IQGilpOxVgLEWNRqQgJELSdjrQSIsajVhASIWk7GWgkQY1GrCQkQtZyMtfoL/XqaTEgSm3UAAAAASUVORK5CYII="],
    ];

    var main = new DummyMain(canvas);
    var parent = new DummyParent(fm);
    _.each(testData, function(data, i) {
        var scope = new Webvs.SuperScope(gl, main, parent, data[0]);
        fm.setRenderTarget();
        // clear
        gl.clearColor(0,0,0,1);
        gl.clear(gl.COLOR_BUFFER_BIT);
        scope.draw();
        fm.restoreRenderTarget();
        copier.run(null, null, fm.getCurrentTexture());
        imageFuzzyOk("superscope test " + i, gl, canvas, data[1]);
        scope.destroy();
    });
});
