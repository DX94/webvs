/**
 * Copyright (c) 2013 Azeem Arshad
 * See the file license.txt for copying permission.
 */

function testTexer(canvas, gl, fm, copier, name, options, value) {
    var texer = new Webvs.Texer(options);
    var promise = texer.init(gl, new DummyMain(canvas), new DummyParent(fm));

    promise.onResolve(function() {
        fm.setRenderTarget();
        texer.update();
        fm.restoreRenderTarget();
        copier.run(null, null, fm.getCurrentTexture());
        texer.destroy();
        equal(canvas.toDataURL(), value, "Texter output in test"+name+" should be correct");
        start();
    });
}

var texerImage = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB0AAAAdCAIAAADZ8fBYAAAAA3NCSVQICAjb4U/gAAACv0lEQVRIidWWMXOiQBTHl5MCFkmbdEuHRdLImNglHwf5JEZLZQgpTT5EZjRWzliRxi/AxnEgnYwJycCye8XLeGfO00h19xoY3s5v//v27f5B6P8KaXda1/V6vV6v1w3DwBinaUopDYLg6elptVqVmZAQ0m63wzDM85xzzjkXQsBLnudhGLbbbULIAURZlm3bjqIIWIyxxWIxnU6Hw+F0Ol0sFowxmCOKItu2ZVneD1UUxfO8LMs450mSuK7bbDYxxpIkIYQkScIYN5tN13WTJOGcZ1nmeZ6qqnuUep7HGOOcj8fjWq22Y3CtVnt8fOScF0Vxc3OzS7Vt26D0/v5e07S9i9M07e7uDlS3Wq3tgwghUNPxePwd6BoNqqMo2r6N19fXUNPdy/8zTNOEWnc6na85XdfDMBRCuK57EBTCdV0hBKVU1/WNxOXlZZ7njLGLi4sS3PPzc8ZYnudXV1fw5Qc8LMuqVCovLy+z2awEdzabxXFcqVQsy9rgGoaBEKKUvr+/l+B+fHw8Pz8jhNZb98mFzn99fRVClOAKIVarlSRJ60b65KZpKoSoVqtwrg4NSZKq1aoQIk3TDW4YhrAKRVFKcBVFgQoA5xc3CIKiKI6Pj8/OzkpwT09PT05OiqIIgmAjoes6pVQI0e/3S3D7/f72/kUIdTodOG+maR4ENU1zuVxuP28IIUJIHMec89FohDH+JhRjPBwOOedxHEOzbolWqwX32WAw+A4aYzwYDOA+cxznr+NkWfZ9vygKUL27IKZpjkYjuH9939/jGqqq+r4PqpfLZa/XazQaqqr+7heNRqPX60FNsyy7vb3d4xdr1Y7jQK3B3+bz+WQyeXh4mEwm8/l87W9xHDuO8y1/W4dhGN1ul1IKtvTFjyml3W73rxu19//h6OjIsizLsgghmqa9vb2t/x+SJDlA5r8ePwEtX9iShlMEzwAAAABJRU5ErkJggg==";

CanvasTestWithFM("Texer Simple", 1, {async: true}, function(canvas, gl, fm, copier) {
    testTexer(canvas, gl, fm, copier, 
        "Texer Simple",
        {
            imageSrc: texerImage,
            wrapAround: true,
            code: {
                init: "n=3",
                perPoint: "x=i;y=0;sizey=i+1;"
            }
        },
        "data:image/png;base64,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"
    );
});

CanvasTestWithFM("Texer Wrap", 1, {async: true}, function(canvas, gl, fm, copier) {
    testTexer(canvas, gl, fm, copier, 
        "Texer Wrap",
        {
            imageSrc: texerImage,
            wrapAround: true,
            code: {
                init: "n=1",
                perPoint: "x=-1;y=-1;"
            }
        },
        "data:image/png;base64,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"
    );
});
