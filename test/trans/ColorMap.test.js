/**
 * Copyright (c) 2013 Azeem Arshad
 * See the file license.txt for copying permission.
 */

CanvasTestWithFM("ColorMap", 7, function(canvas, gl, fm, copier) {
    var gprogram = new GradientProgram(gl, 0);

    var maps = [
        [{index:0, color: "#000000"},{index:255, color: "#FFFFFF"}]
    ];
    var testValues = [
        {maps:maps, key: "RED"},
        {maps:maps, output: "AVERAGE", key: "RED"},
        {maps:maps, key: "GREEN"},
        {maps:maps, key: "BLUE"},
        {maps:maps, key: "(R+G+B)/2"},
        {maps:maps, key: "(R+G+B)/3"},
        {maps:maps, key: "MAX"},
    ];
    var expectedImages = [
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAABu0lEQVR4Xu3d0QqCQBBGYVff/5ktocBsW9ZxiUG+qyBMqnXmzPlLLaWUdVmWaZ7naf9Yey6yzfs19tf3HT/Xw4JsB0uWA8aCvDqDBQm2ybu3QBWiQr7hduaoP7NtTxvKtj8VokJUSKsqVYgKUSEqpDJiR1KHfwwJWpaWpWVpWVpWX7IZ6ePZRO74Ga6+PwzBEAzBEAzBkB5nqW2DIRiCIRiCIRiCITf5jR7UQR3UQR3UQR3UQb3v/7BX4+jR8Xb2/ZmyTFmmLFOWKcuUZcoyZZmyWlWgQlSIClEhuyqItgRimEy8LIgF+boGADEkhsQwyjjhYrKWakEsiLQX1EEd1EFdliXLkmXJsj4v++ckzd8TYuS7ccJOY9qKQnh0WEkMiSExJIbEkBhGmYQhGIIhGIIhGIIhwkXhonBRuChcPHtPlaun8PEQHsJDeAgP4SE8hIfwEB7CQ3gIDznc4HL0nwiy748YEkNiSAyJITEkhsSQGBJDYkgMiSExLGutF0anhOwmnP39MXWmztSZOlNn6lEGYwiGYAiGYAiGYIi0V9or7ZX2SnulvdJeae9WBdGpaHR6zNSZOlNvmfoDQayNuBrQ+A4AAAAASUVORK5CYII=",
        "data:image/png;base64,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",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAACqklEQVR4Xu3R4UYrAABA4Y1EIhKJRGJkZCQSM2IiY0YiMjJmZGREIpHIiEQikUiMxIxEIhKJRGJiJCYyMiKR6N7XOD/OeYTzBf/+/v4FDHMg+Pv7KwiGIxAI/vz8CEIC+f7+FoQE8vX1JQgJ5PPzUxASSLPZFIQE8vHxIQgJpNFoCEICeX9/F4QE8vb2JggJpF6vC0ICeX19FYQE8vLyIggJpFarCUICeX5+FoQEUq1WBSGBPD09CUICeXx8FIQE8vDwIAgJ5P7+XhASyN3dnSAkkNvbW0FIIDc3N4KQQK6vrwUhgVxdXQlCArm8vBSEBHJxcSEICeT8/FwQEsjZ2ZkgJJBKpSIICaRcLgtCAjk9PRWEBHJyciIICaRUKglCAjk+PhaEBHJ0dCQICeTw8FAQEsjBwYEgJJD9/X1BSCB7e3uCkEB2d3cFIYHs7OwIQgLZ3t4WhASytbUlCAlkc3NTEBJIsVgUhASysbEhCAlkfX1dEBLI2tqaICSQ1dVVQUggKysrgpBAlpeXBSGBLC0tCUICWVxcFIQEUigUBCGBLCwsCEICyefzgpBA5ufnBSGB5HI5QUgg2WxWEBJIJpMRhAQyNzcnCAkknU4LQgKZnZ0VhAQyMzMjCAlkenpaEBLI1NSUICSQVColCAkkmUwKQgJJJBKCkEAmJycFIYFMTEwIQgKJx+OCkEDGx8cFIYHEYjFBSCDRaFQQEsjY2JggJJDR0VFBSCAjIyOCkECGh4cFIYFEIhFBSCBDQ0OCkEDC4bAgJJDBwUFBSCChUEgQEsjAwIAgJJD+/n5BSCB9fX2CkEB6e3sFIYH09PQIQgLp7u4WhATS1dUlCAmks7NTEBJIR0eHICSQ9vZ2QUggbW1tgpBAWltbBSGBtLS0CEICCQaDgoBA/gMBHvlrJ2nWFAAAAABJRU5ErkJggg==",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAABbUlEQVR4Xu3TsQkAMAzEQHv/oZMUGULFGdwLid+ZOe9dxMAKEinxMQRp9RhBBIkZiOFYiCAxAzEcCxEkZiCGYyGCxAzEcCxEkJiBGI6FCBIzEMOxEEFiBmI4FiJIzEAMx0IEiRmI4ViIIDEDMRwLESRmIIZjIYLEDMRwLESQmIEYjoUIEjMQw7EQQWIGYjgWIkjMQAzHQgSJGYjhWIggMQMxHAsRJGYghmMhgsQMxHAsRJCYgRiOhQgSMxDDsRBBYgZiOBYiSMxADMdCBIkZiOFYiCAxAzEcCxEkZiCGYyGCxAzEcCxEkJiBGI6FCBIzEMOxEEFiBmI4FiJIzEAMx0IEiRmI4ViIIDEDMRwLESRmIIZjIYLEDMRwLESQmIEYjoUIEjMQw7EQQWIGYjgWIkjMQAzHQgSJGYjhWIggMQMxHAsRJGYghmMhgsQMxHAsRJCYgRiOhQgSMxDDsRBBYgZiOBYiSMxADMdCYkEuN71kAdKuUAcAAAAASUVORK5CYII=",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAFVElEQVR4Xu2d90sdQRDH8xQVCxZULFhQsaBiwYKKBQsqFiyoWFCxYEHFggUVxf/cGNHwYvbt29mdnb29mx9CErK5uzef/X5m9+4lF3t7e3uPxWK//vxISUn5/Pnnr5P9Pv7vmYzFOo6tz0Jyfa+vr++yE+n+ma2iQI5LUsAfE9n4+l5eXj4TkigdDMSePYS1fX5+/psQVta/ExMy29HGPj09/aOsbygu4u7inJBCklzf4+Pjf01dNSkkF4jt6K9FCwSErbHC+j08PAibuotiuzgnpNgk13d/f59wlUWdFJIPHPTE3d3dSfchvMoiXmXd3t4m3RjqLIkhKrA11svE3dzcKG0MKZLiZQGxFwnX19dKQHQ3j5DZz0A+9Hh1dZVUWfFFVW30EBC2xnoJ+PLyEgQkERyTm4oMJG7hcHFxoaws20nxckZj95Dz83NwQr7BcAGTP6oAL4bOzs60gUBU4wKei3Ma1+T09FRLWTZ6iZcFxFbWycmJMRDjWeHwKSXWtUOOIx17fHxspCzVpLiY/S7OCQEjvL6joyM0IBSbR+MPjK0Y7JuVh4eHKMrCSIqXMxob8MHBAToQ3aQwkI9l9P7+PqqybG8eQ6+svb09a0BUNQYpMmSsl4nb3d21oiydpHhZQOwesrOzYzUhLm+zeAl4e3ubBIgL1XgJZGtry7qyVHuJlwXEVtbm5iYpEN0lMSRhtsaSTJiNjQ0yZVEnhaSA2Dv19fV1J0AokuIlkLW1NXJl6SyJbWkIclwSwKurq06BqGoMUjhbY0mArKysOFOW7aSQFBC7hywvLztPiMvNIyRNJICXlpYCAyRwxXHx7y4XFxcDoSwbvYRkRmMra2FhIXBAsJLiJZD5+flAKUs1KS6KTXLOubm5wAKh2DxipRFyHOnY2dnZQCoLIykkMxq7h8zMzAQeiG5SvAQyPT0daGXZ3jxCVEMCeGpqyhsgqhqDFBkylgTI5OSkF8rSSQpJAbF7yMTEhFcJcXmbhQTw+Pi4l0BcqIYEyNjYmHfKUu0lJAXEVtbo6KjXQHSXxJCE2RornDAjIyPeKos6KSSJGx4eDgUQiqSQABkaGvJeWTpLYlsaghxXCHhwcDBUQFQ1BimcrbFCIAMDA6FRlu2kkCirv78/dAlxuXmEpEkIuK+vL7RAjIuD/b1dlWf0vb29oVSWjV5Coqyenp7QA8FKCgmQ7u7uUCtLNSkkxVZRVldXV2SAUGwejdPY2dkZCWVhJIUkRR0dHZEDopsUEiDt7e2RUpbtzaOxstra2iILRFVjkCJDxgoT19raGkll6SSFRFktLS2RTojL2yxCwM3NzQzk61VP8QWSpQErKcLjNDU1RV5Zqr0EC4S0zzQ2NjIQxVc+kQBpaGhgZQneTudMWfX19QwkwesCE/UUrKQIj1NXV8fKkny3SrXRQ/Yf0rG1tbUMRPHLbljJkAKpqalhZSm84dRGUoSAq6urOSFJEkK6eayqqmIgikAgfUJbb5WVlawsBWWpbh6NoVVUVDAQIBDjosv+r/vy8nJWFkBZqknRVlZZWRkD0QSi++RRmrDS0lJWloayMJIiTFFJSQkDMQSimxQhkOLiYlaWgbJ0njxKlVVUVMRAkICoakwKpLCwkJWFoCydpAiVVVBQwAlBTIjxbZb8/HwGYgGI9uYxLy+PlYWsLNVeIlRWbm4uA7EIBLwkzsnJYWVZUpZWUrKzsxkIARDlpGRlZbGyLCsLtCTOzMxkIIRAkmosIyODlUWkLKWkpKenc0KIEyLdPKalpTEQR0CEjT41NZWV5UBZCXvJx26RgTgG8iMpMVaWQ2X9TMpv0EVD5JC9UM0AAAAASUVORK5CYII=",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAEdUlEQVR4Xu2d13LbMBBFDffee++99y733sv/f4qjZMKJFUsCubuAluT1jB88GpAgD3bvAenE5vPz88sYUxZ8l2W/vv/M/QzHi3hvPz4+AOTbgiz5Anx/f88BEmZCWPURV/1/wIvdP/P29gYgf29YoRvlcwGa19fXgkA4ueLzIijnooz5fT+cQ3t5eQGQCC3FOZDn52cA0QikaNBYeqyXUmbMIVbze3p6+lMhAPLPnEqanY+Pj6H3IZyJxmqVCrQw6vWah4cHANGkvff395H3Idg8yrS3vFV0d3cHIAItSmxfEwChHtCWK9TjOvd9rdZ2e3trtSyOgQFIxOdeNzc3AKLpae/19XVoy+JUClUDKRVGGaNlfubq6gpANGnv5eVlZMtyVSlaVimlwihj8l7vxcUFgGjS3gCIGGGBi0t1pZyfn7Msy9a+pEEn/nhnZ2cioW4Dk+pVH6FrmNPTUwDRZFknJyeioc6pFFRRdlefyWQAJEJLcf6M7fj4GEA0AvFpL7YnxKluXUdHR060F1lCfIl1eHjo1LJcgUlqFZmDgwMA0aS9+/v73kKdUy0+M45yLsqYvFW+t7cHIJosKwAiRpj5rtpmYFrm6Ww/sru7692y0LqKGNjOzg6AaHqnvr29XTLL4lRKYrV3a2sLQDRp7+bmZskty1WlxLKKNjY2AEST9gZAtOukTYdt/8bFmaYKwMyZ+/r6uirLsrUv7QuHPb+1tTWVoW4DE8t8CLFpNqurqwCiybJWVlZUhzqnUmJZRcvLywAiEMzs7AjmsLS0BCAagYgRDhFclHOlpnUtLi7GQntTA2RhYSFWluUKjBYBMPPz8wCiSXvn5uZiG+qcaqHkmJcqmp2dBRBNlhUAUbtimNZmeyip7rpnZmZib1mJal3T09MAoumd+tTUVGIsi1MpXgI7RPs1k5OTAKJJeycmJhJnWa4qxUsVjY+PA4gm7Q2AqNM/gZtke89u+5xyTyhjcuYxNjaWaMuytS/2DZReOKOjo6kIdRsYL/kQxrJGRkYARJNlDQ8PpyrUOZXipYqGhoYARCAHxLJocHAQQDQCESMcIrgo56KMobYY2xNi6nFDXcPAwEAqtVdtlvT396faslyBoVaR6evrA5ACj985rYsMpLe3F6EeIvdscELlQx7wP8b19PQAiEYgYoRDXBzlXJQx1LbByRX2PLu7u2FZEfYhzltXV1cXgGgC0tnZCcsi/JKDrVKo7dJ0dHQAiCYg7e3tsCzG43dOpeStora2NgDRCIStaxGCkXIuyhhqH6eeS+QdfWtrKyxLaDGJAGlpaUGoE0Ld1ebRNDc3A4gmIE1NTQh1RqhzKiVvi2tsbAQQTUAaGhoARCMQquoVGofjEf+r8fr6emivgPaKZUldXR0sS9CyuGBMbW0tgGgCUlNTg1B3FOqkaqmurgYQjUBgRRH/zLaACASP7nM2iFVVVbAsgZtLXdA/3qdUVlYCiCYgFRUVsCxPlhUm5E15eTmAaAKS7WGwLM+WVbRSsh8CiCIgvwBrZfkC9BIK4gAAAABJRU5ErkJggg==",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAE40lEQVR4Xu3dYUQtQRQH8DvdRCISiUQiEolEIhGJRCIRiUQikYhEIpGIRCKRSEQikUhEIpFIJCKRSCQikai35XX1ent3z8yZnZ2ZPffzuB/Ob/67858bsff3948YfbSZAHt7eyMQTTji8XiMvb6+EogGICkpKbEvkJeXFwIJGeQTIgHy/PxMICGCfEMkQJ6enggkJJCfyUiAPD4+EkgIIJ8YriAPDw8EohjkOw2uIPf39wSiEOQngivI3d0dgSgC+f0CdwW5vb0lEAUgbsN3Bbm5uSGQgEF+J8PzHXJ9fU0gAYK4pcAT5OrqikACAkmWDE+Qy8tLAgkAxCsZniAXFxcEIhkkWekDnbLOz88JRCKI1+4HgZydnRGIJBC/0gcCOT09JRAJIJBhQ9awk5MTAkGCQEsfCOT4+JhAECA8pQ8EcnR0RCCCILylDwRyeHhIIAIgIqUPBHJwcEAgnCCipQ8Esr+/TyAcIH7JQPeQvb09AgGCQJKBBtnd3SUQAAj0OgQNsrOzQyA+IDxD5lnr+gPV9vY2gXiA8F6HoEG2trYIJAkI5FQkvRhubm4SiAuI6HUIOiEbGxsE8gsEs+vRIOvr6wTyAwR7HYIGWVtbI5C/IH6lT0kPWV1dJRAHBDJsyBp0QlZWViIPAi19SkCWl5cjDYLd0ZgDgGsxXFpaiiwIb+lTkpDFxcVIgoiUPiUgCwsLkQMRLX1KQObn5yMFIvuZL/v72NzcXGRAsKVPSUJmZ2cjASKj9CkBmZmZsR4EMkhZa7DHaDY9PW01iF8ysAOU/g6ZmpqyFgSy67UDmZyctBIEeh2iHcjExIR1IDxD5lmrInFsfHzcKhDe6xDtQMbGxqwBEbkO0Q5kdHTUChDR6xDtQEZGRowHwRw9tQMZHh42GgR7HaIdyNDQkLEgfqVPxakIk07XH6gGBweNBIEMG7JGu4QMDAwYBwItfUaC9Pf3GwWi246W/sjq6+szBoS39BmZkN7eXiNAREqfkSA9PT3ag4iWPiNBuru7tQaR/YzW/ftYV1eXtiDY0mdkQjo7O7UEkVH6jATp6OjQDgQySFlrdDtGs/b2dq1A/JKh2wBlv5NYW1ubNiCQXW89SGtrqxYg0OsQ60FaWlpCB+EZMs9aExPHmpubQwXhvQ6xHqSpqSk0EJHrEOtBGhsbQwERvQ6xHqShoUE5COaoaD1IfX29UhDsdYj1IHV1dcpA/EqfiaciTNpdf1Ovra1VAgIZNmSN9QmpqakJHARa+gjE+ceS1dXVgYLYvqOlP7KqqqoCA+EtfZQQJyGVlZWBgIiUPgJxQCoqKqSDiJY+AnFAysvLpYLIfqZG7ftYWVmZNBBs6aOEOAkpLS2VAiKj9BGIA1JSUoIGgQxS1hrbj9GsuLgYBeKXDNsHKPsdx4qKioRBILueQOIxHjRWWFgoBAK9DiEQTpCCggJuEJ4h86ylxDkv9fz8fC4Q3usQAuFMSF5eHhhE5DqEQDhBcnNzQSCi1yEEwgmSk5PjC8JzSsCspXeI8w7Jzs72BMFeh1BCOBOSlZWVFMSv9NGO5hs25B3MMjMzXUEgw4asoYTwobGMjIz/QKClj0D4hg1KSHp6+j8gtKNxQ8bOj6WlpSVAeEsfJQSH5/p3WampqV8gkDiJrMHumKgdo5nz+RAtfZQQ+Qn5Axp2jbhnMrXhAAAAAElFTkSuQmCC"
    ];

    var main = new DummyMain(canvas);
    var parent = new DummyParent(fm);

    _.each(testValues, function(opts, index) {
        var colormap = new Webvs.ColorMap(gl, main, parent, opts);
        fm.setRenderTarget();

        // clear
        gl.clearColor(0,0,0,1);
        gl.clear(gl.COLOR_BUFFER_BIT);

        // generate gradient
        gprogram.run(fm, null);
        colormap.draw();
        
        fm.restoreRenderTarget();
        copier.run(null, null, fm.getCurrentTexture());

        imageFuzzyOk("ColorMap " + index, gl, canvas, expectedImages[index]);
        colormap.destroy();
    });

    gprogram.destroy();
});
