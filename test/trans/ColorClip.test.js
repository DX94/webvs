/**
 * Copyright (c) 2013 Azeem Arshad
 * See the file license.txt for copying permission.
 */

CanvasTestWithFM("ColorClip", 4, function(canvas, gl, fm, copier) {
    var gprogram = new GradientProgram(gl);

    var testOptions = [
        {mode: "BELOW", color: "#7F7FFF", outColor: "#000000"},
        {mode: "ABOVE", color: "#7F7FFF", outColor: "#000000"},
        {mode: "NEAR", color: "#7F7FFF", outColor: "#000000", level: 0.5},
        {mode: "NEAR", color: "#7F7FFF", outColor: "#000000", level: 1}
    ];
    var expectedImages = [
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAACFUlEQVR4Xu3cQUSFQRSG4TuVSEQikUhEIpFIJCKRSCQikUgkEpFIXJGIRCKRSEQikUhEIpFIJCKRSCQikejvtogWLXJXb3mHYxgzs5jnzPYL4T2KUmOxWEqivs8/rSWz5+uM9/3ujUN4E+SzWSgNE8KrICyQF0FYIM+CsECeBGGBPArCAnkQhAVyLwgL5E4QFsitICyQG0FYINeCsECuBGGBXArCArkQhAVyLggL5EwQFsipICyQE0FYIMeCsECOBGGBHArCAjkQhAWyLwgLZE8QFsiuICyQHUFYINuCsEC2BGGBbArCAtkQhAWyLggLZE0QFsiqICyQFUFYIMuCsECWBGGBLArCAlkQhAUyLwgLZE4QFsisICyQGUFYINOCsECmBGGBTArCApkQhAUyLggLJC4ICiSR3RUl6s+P+FiUVCoeLfEu/BuQUUFQvyo+IggLZFgQFsiQICyQQUFYIAOCsED6BWGB9AnCAukVhAXSIwgLpFsQFkiXICyQTkFYIB2CsEDaBWGBtAnCAmkVhAXSIggLpFkQFkiTICyQRkFYIA2CsEDqBWGB1AnCAqkVhAVSIwgLpFoQFkiVICyQSkFYIBWCsEDKBWGBlAnCAikVhAVSIggLpFgQFkiRICyQQkFYIAWCsEDyBWGB5AnCAskVhAWSIwgLJFsQFkiWICyQTEFYIBmCsEDSBWGBpAnCAgn/A+QDl+RcshFMEu8AAAAASUVORK5CYII=",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAACkUlEQVR4Xu3cbWTWURzG8ft/r5W1LK1pzdqsUtbSSitb04NSzdq0ZpWlmtWsZpVqNrX0oMZEZMyYMWNiTGRkTIzExERGImZkzJgRMxK7Wy9iL3oxN5urr+twHH7OOc75fd5fQTAXicSEQqHw/Fy4/qsWzZ6/Z5b6vmfhYP4H//8Igl8QkFgKyE8IyCoKyCwEZDUFZAYCsoYC8gMCspYCMg0BSaSATEFAkiggkxCQZArIBAQkhQIyDgHZRAH5DgFJp4CMQUA2U0BGISBbKSDfICDbKSBfISA7KCBfICA7KSAjEJBsCshnCMgeCsgnCEgOBWQYArKfAvIRApJHARmCgORTQD5AQA5RQN5DQI5QQAYhIMcoIO8gICcoIAMQkAIKSD8E5BQF5C0EpJgC0gcBKaGAvIGAlFJAXkNAzlJAeiEg5ykgPRCQCxSQVxCQSxSQbghIBQWkCwJyhQLSCQGpooB0QECuUUDaISA1FJA2CMgNCkgrBOQWBaQFAnKHAvISAlJHAXkBAWmggDyHgNyngDRDQB5QQJogII8oIE8hIE8oII8ZINGm4i1X4t1i3xcEDw3yp1lLHUG4eJBGg2iB3DOIFki9QbRA7hpEC+S2QbRAbhpEC6TWIFog1w2iBVJtEC2QqwbRAqk0iBbIZYNogVw0iBZIuUG0QM4ZRAukzCBaIGcMogVy2iBaIEUG0QIpNIgWyEmDaIEcN4gWyFGDaIEcNogWyEGDaIEcMIgWSK5BtED2GUQLZK9BtEB2G0QLZJdBtECyDKIFkmkQLZBtBtEC2WIQLZAMg2iBpBlECyTVIFogGw2iBbLBIFog6w2iBbLOIFogCQbRAok3iBZInEG0QFYaRAtkhUG0QAKDKIH8BpPgae07Pj8fAAAAAElFTkSuQmCC",
        "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAEMUlEQVR4Xu3cD2RVURwH8N1KJCKRSCQikUgkEsta1rKWtSxrWctaVlnLspa1rGUtm7VZy/7Ylv2xedu8bd7evL15syKRSCQikUgkIpHotbN6tdbbdre7fc/3PL/H83j/OOdzf79zzr2/eyzrRzC4NCoqasn4c/JruPfm853Qb+T/7PWxZX0XEHWwsBwwlvVNQLhAvgoIF8gXAeEC+SwgXCCfBIQL5KOAcIF8EBAukPcCwgXyTkC4QN4KCBfIGwHhAnktIFwgrwSEC+SlgHCBvBAQLpDnAsIF8kxAuECeCggXyBMB4QJ5LCBcII8EhAvkoYBwgYwJCBdIwEyQin3WeDXV9I/yQNBWrRVbIZ9l+flB6vfP3Pkzyvz+sNY/MxBPoZyPF6T5gHOIqVgNvvAwPCBePpC2gwsPES6KWr3BPzXNPCAeLpCOQxiMEFC751fE8ID0c4B0H8ZCTI6Yzn57EwA7aE4nCZblJgE5og9E4bjcf9PX1Nsu5tLJc/luOGDL6tEL0ndUL8TUscXdMz0MJkJc+kAGjnFhKBy3SzdIpx6QweN8GKFo6e+c/9TYecpq1wRyghdEwXja/48UTMpqxYMMneTGCEWKt/XfSMGAtGBBhk+ZgRFC8bXMbfHoPGU1gUFOGwbShAZpwIGMnDELQ0WJrwENUgcEOWseiELx19k/veI8ZdViQEbPmYkxAVKLBKkBgVwwF0ShBGrsne9yHiFVIJCLhoNUoUAqQSCXDAepRIGULz7Ig8tmY0ykrHIUSBkA5Ir5IAplrGz2U/TOx5BSAMjVCAEpRYCUAECuRQhICQKkGAByPUJAihEgRQCQGxECUoQAKQSA3IwQkEIESAEA5FaEgBQgQPIBILcjBCQfAZIHAKkwHySQh1oY5gJA7kQASC4KJGfxQdS16NFqs1ECOSiQ8yCQu4aDnEeBZINA7hkOko0CyQKB1JsL4s9CXjHMxICocWSk0UwUfyYSJAMHok5NDzebheLLQFedpINB7hsGko4GScOCqNQ11GYGijdNRylpqgaQDn4QT6quYusUPIgaSwa7uFE8KbpAkvWAqNQ10M2H4k7WfcNOkj4QFSl9vVwo7iTdIIl6QVSk9PZxoPQkOt/twXnVSYJ+ENWI7gG9KK6E2a91YG7YiecAUY3tGsSjtMfbX4VjQOJ4QEINbhvCwLTGzW3RhwGJ5QMJNbx5eHFgmmLnN6XFgMTwgqgOaBxZOJS6GGczKAxINDfI1G0uqkftA1VGzz5QO50VOdmGI/zWGnvNAmHrwIUH2SMgXNsz7RYQLpBdAsIFslNAuEB2CAgXyHYB4QLZJiBcIFsFhAtki4BwgWwWEC6QTQLCBbJRQLhANggIF8h6AeECWScgXCBrBYQLZI2AcIGsFhAukFUCwgWyUkC4QFYICBfIcgHhAlkmIFwgloAwgfwEJrLysljvH3QAAAAASUVORK5CYII=",
        "data:image/png;base64,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"
    ];

    var main = new DummyMain(canvas);
    var parent = new DummyParent(fm);

    _.each(testOptions, function(opts, index) {
        var colorclip = new Webvs.ColorClip(gl, main, parent, opts);
        fm.setRenderTarget();

        // clear
        gl.clearColor(0,0,0,1);
        gl.clear(gl.COLOR_BUFFER_BIT);

        // generate gradient
        gprogram.run(fm, null);
        // clip
        colorclip.draw();

        fm.restoreRenderTarget();
        copier.run(null, null, fm.getCurrentTexture());

        imageFuzzyOk("ColorClip " + index, gl, canvas, expectedImages[index]);
    });

    gprogram.destroy();
});
