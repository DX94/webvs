!function(){function a(){var a=$(this).data("webvs-ui"),b={id:C++,ui:a,label:a.disp,enabled:!0,clone:1,values:{}};a.isJson&&(b.values.json="{}"),u.tree("appendNode",b,v),u.tree("openNode",v)}function b(){var a=u.tree("getSelectedNode");1!==a.id&&(u.tree("selectNode",a.parent),u.tree("removeNode",a))}function c(a){var b=a.node;w.empty(),b&&w.jsonForm({schema:b.ui.schema,form:b.ui.form||["*"],onSubmitValid:d,value:b.values,forceDefaults:!0})}function d(a){var b=u.tree("getSelectedNode");b.values=a,f()}function e(a){var b={};return a?b.type=a.ui.type:a=v,a.enabled||(b.enabled=!1),a.clone>1&&(b.clone=a.clone),a.children&&a.children.length>0&&(b.components=_.map(a.children,e)),b=a.ui.isJson?_.extend(b,JSON.parse(a.values.json)):_.extend(b,a.values)}function f(){var a=e();try{A.loadPreset(a),A.start(),$("#load-status").removeClass("fail")}catch(b){$("#load-status").addClass("fail"),console.log("Error loading preset "+b)}}function g(a){function b(a){var c;c=a.type?y[a.type]:Webvs.ui;var d={id:C++,ui:c,enabled:!_.isBoolean(a.enabled)||a.enabled,clone:a.clone>1?a.clone:1};d.label=o(d.enabled,c.disp,d.clone),a.components&&(d.children=_.map(a.components,b));var e={};return _.chain(_.keys(a)).filter(function(a){return"components"!=a&&"type"!=a&&"enabled"!=a&&"clone"!=a}).each(function(b){e[b]=a[b]}),d.values=c.isJson?{json:JSON.stringify(e,void 0,2)}:e,d}C=1;var d=b(a);u.tree("loadData",[d]),v=u.tree("getNodeById",1),u.tree("selectNode",v),c({node:v})}function h(a){a.preventDefault();var b=$("#search-form input"),c=$("#search-result ul"),d=b.val();SC.get("/tracks",{q:d},function(a){b.val(""),c.empty(),_.each(a,function(a){var b=$("<a href='#'/>").data("webvs-track",a).text(a.title);$("<li/>").append(b).appendTo(c)})})}function i(){var a=$(this).data("webvs-track"),b=$("#play-queue ul");$("<li/>").data("webvs-track",a).text(a.title).appendTo(b)}function j(){$("#play-queue ul li.playing").remove();var a=$("#play-queue ul li:first");return 0===a.length?!1:(B=a.data("webvs-track"),a.addClass("playing"),z.pause(),z.load({src:B.stream_url+"?client_id="+D}),!0)}function k(){if(B)z.isPlaying()?(z.pause(),$(this).text("Play")):(z.play(),$(this).text("Pause"));else if(j()){var a=this;z.onceAt(Math.floor(B.duration/1e3),function(){B=null,k.call(a)}),$(this).text("Pause"),z.play()}}function l(){z.pause(),j(),z.play()}function m(){var a=$("#dim-factor").val(),b={width:$(window).outerWidth(),height:$(window).outerHeight()},c={width:b.width/a,height:b.height/a};$("#webvs-canvas").attr(c).css(b)}function n(){m(),A.resetCanvas(),A.start()}function o(a,b,c){return(a?"":"! ")+b+(c>1?" x"+c:"")}function p(){var a=u.tree("getSelectedNode"),b=!a.enabled;u.tree("updateNode",a,{enabled:b,label:o(b,a.ui.disp,a.clone)}),f()}function q(){var a=u.tree("getSelectedNode"),b=prompt("Enter the number of times this component should be cloned",a.clone);b=parseInt(b,10),b=_.isNaN(b)?a.clone:b,u.tree("updateNode",a,{clone:b,label:o(a.enabled,a.ui.disp,b)}),f()}function r(a,b){return a.super?a.super.constructor==b?!0:r(a.super.constructor,b):!1}function s(){y={},_.chain(Webvs).pairs().filter(function(a){return r(a[1],Webvs.Component)}).map(function(a){var b=a[0],c=a[1],d=c.ui;return d||(d=_.extend({type:b,disp:b,isJson:!0},E)),d=_.defaults(d,{leaf:!0})}).each(function(a){y[a.type]=a,$("<li><a href='#'>"+a.disp+"</a></li>").data("webvs-ui",a).appendTo(".new-button .dropdown-menu")}),w=$(".form"),x=$("#tree-context-menu"),$("#main-window").draggable({handle:".top"}),u=$(".tree"),u.tree({dragAndDrop:!0,onCanMoveTo:function(a,b,c){var d=b.ui;return!("inside"==c&&d.leaf||1===b.id&&"inside"!=c)},data:[]}),u.bind("tree.contextmenu",function(a){var b=u.tree("getSelectedNode");b.id!=a.node.id&&u.tree("selectNode",a.node),1!==b.id&&(b.enabled?x.find(".toggle-enable").text("Disable"):x.find(".toggle-enable").text("Enable"),x.show().css({left:a.click_event.pageX,top:a.click_event.pageY}))}),$(document).click(function(){x.hide()}),g(F),m(),$(".new-button .dropdown-menu li").click(a),$(".remove-button").click(b),u.bind("tree.select",c),w.change(function(){w.submit()}),$("#dim-factor").on("change",n),$("#tree-context-menu .toggle-enable").click(p),$("#tree-context-menu .clone").click(q);var d;$(window).on("resize",function(){clearTimeout(d),d=setTimeout(n,100)}),$("#search-form").submit(h),$(document).on("click","#search-result ul li a",i),$("#play-btn").click(k),$("#skip-btn").click(l)}function t(){SC.get("/tracks/88460121",function(a){var b=$("#play-queue ul");$("<li/>").data("webvs-track",a).text(a.title).appendTo(b),$("#play-btn").click()})}var u,v,w,x,y,z,A,B,C=2,D="e818e8c85bb8ec3e90a9bbca23ca5e2a",E={schema:{json:{type:"string",title:"json","default":"{}"}},form:[{key:"json",type:"textarea"}]},F={name:"Silk Strings",author:"Steven Wittens / UnConeD (http://acko.net)",clearFrame:!0,components:[{type:"GlobalVar",code:{init:["n=0; /*global*/","off=.015;sweep=.75;","zm=1;zmt=1;","oxt=rand(200)*.01-1;oyt=rand(200)*.01-1;ozt=rand(200)*.01-1;","ox=oxt;oy=oyt;oz=ozt;vx=ox;vy=oy;vz=oz;","t=0;"].join("\n"),perFrame:["tm=gettime(0);","dec=dec*.7+(1-pow(.9,(27*(tm-lt))))*.3;","reg90=dec;","lt=tm;","zm=zm*.8+zmt*.2;","ox=ox+(oxt-ox)*dec;oy=oy+(oyt-oy)*dec;oz=oz+(ozt-oz)*dec;","ot=.1+zm*invsqrt(sqr(ox)+sqr(oy)+sqr(oz));","ox=ox*ot;oy=oy*ot;oz=oz*ot;","vx=vx+(ox-vx)*dec;vy=vy+(oy-vy)*dec;vz=vz+(oz-vz)*dec;","rz=0;","rry=atan2(-vx,vz);","rrx=-atan2(vy,sqrt(sqr(vx)+sqr(vz)));","ry=if(t,ry+sin(rry-ry)*dec,rry);rx=if(t,rx+sin(rrx-rx)*dec,rrx);","cx=cos(rx);sx=sin(rx);cy=cos(ry);sy=sin(ry);cz=cos(rz);sz=sin(rz);","reg41=off;","reg01=ry;reg02=cos(ry);reg03=sin(ry);","reg04=rx;reg05=cos(rx);reg06=sin(rx);","reg10=vx;reg11=vy;reg12=vz;","reg40=reg40+off;","reg80=reg80+(reg79-reg80)*sweep;","reg79=reg79+(reg78-reg79)*sweep;","reg78=reg78+(reg77-reg78)*sweep;","reg77=reg77+(reg76-reg77)*sweep;","reg76=reg76+(reg75-reg76)*sweep;","reg75=reg75+(reg74-reg75)*sweep;","reg74=reg74+(reg73-reg74)*sweep;","reg73=reg73+(reg72-reg73)*sweep;","reg72=reg72+(reg71-reg72)*sweep;","reg71=reg71+(reg70-reg71)*sweep;","reg70=reg70+(b*3-reg70)*sweep;","t=1;"].join("\n"),onBeat:["zmt=rand(100)*.01+.2;","oxt=rand(200)*.01-1;oyt=rand(200)*.01-1;ozt=rand(200)*.01-1;"].join("\n")}},{type:"SuperScope",clone:18,code:{init:["n=90;","md1=rand(100)*.1;md2=rand(100)*.1;"].join("\n"),perFrame:["ox=reg10;oy=reg11;oz=reg12;","ry=reg01;cy=reg02;sy=reg03;","rx=reg04;cx=reg05;sx=reg06;","off=reg41;","asp=w/h;","t=reg40;","pt=t;","cx=cos(rx);sx=-sin(rx);cy=cos(ry);sy=-sin(ry);cz=cos(rz);sz=-sin(rz);","j=0;","dt=1;"].join("\n"),perPoint:["lj=j;","j=i*10;j=j-floor(j);j=(3-2*j)*sqr(j);","cv=if(below(i,.1),reg70+(reg71-reg70)*j,if(below(i,.2),reg71+(reg72-reg71)*j,if(below(i,.3),reg72+(reg73-reg72)*j,if(below(i,.4),reg73+(reg74-reg73)*j,if(below(i,.5),reg74+(reg75-reg74)*j,if(below(i,.6),reg75+(reg76-reg75)*j,if(below(i,.7),reg76+(reg77-reg76)*j,if(below(i,.8),reg77+(reg78-reg77)*j,if(below(i,.9),reg78+(reg79-reg78)*j,reg79+(reg80-reg79)*j)))))))));","rd=sqrt(i);","tth=sin(pt)*cos(pt*1.123+md1)+cos(pt*4.411+md2)+pt*4+sin(pt*.31);","tph=2*(cos(pt*1.66)+sin(pt*2.32+md2)*cos(pt*3.217-md1))-pt*.081-cos(pt*9.167)*cos(tth);","ss=sin(tth)*rd;","px=cos(tph)*ss;py=sin(tph)*ss;pz=cos(tth)*rd;","pt=pt-off;","px=px+ox;py=py+oy;pz=pz+oz;","x1=px*cy-pz*sy;z1=px*sy+pz*cy;","y2=py*cx-z1*sx;z2=py*sx+z1*cx;","x3=x1*cz-y2*sz;y3=x1*sz+y2*cz;","ldt=dt;","dt=if(above(z2,.01),1/z2,0);","x=if(dt,x3*dt,x);y=if(dt,y3*dt*asp,y);","cv=band(dt,ldt)*(.5+cv*5);","red=(1-sqr(i))*cv;","green=if(above(cid, 15), red, red*.5);","blue=if(above(cid, 15), red, red*.5);"].join("\n")}},{type:"EffectList",input:"REPLACE",output:"ADDITIVE",components:[{type:"Convolution",scale:8,kernel:[0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0]},{type:"Convolution",scale:4,kernel:[0,0,0,1,0,0,0,0,0,1,0,1,0,0,0,1,1,0,1,1,0,1,0,0,0,0,0,1,0,1,1,0,1,1,0,0,0,1,0,1,0,0,0,0,0,1,0,0,0]}]},{type:"ColorMap",output:"ADDITIVE",maps:[[{color:"#521237",index:43}]]}]};$(document).ready(function(){s(),SC.initialize({client_id:D}),z=new Dancer,A=new Webvs({canvas:$("#webvs-canvas").get(0),analyser:new Webvs.DancerAdapter(z),showStat:!0}),A.loadPreset(F),A.start(),t()})}();